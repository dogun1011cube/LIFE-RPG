<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LIFE RPG – 보상 시간 종료</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div>
        <h1>LIFE RPG – BLOCKED</h1>
        <div class="sub">보상 시간이 끝났어. 다시 “공부 모드”로 돌아가자.</div>
      </div>
      <div class="btns">
        <button id="backBtn">게임으로 돌아가기</button>
      </div>
    </header>

    <main class="grid" style="grid-template-columns:1fr;">
      <section class="panel">
        <h2>상태</h2>
        <div id="blockedInfo" class="drop"></div>
        <div class="hint">돌아가기는 항상 index.html로 이동하며, 가능하면 차단 플래그를 해제해.</div>
      </section>
    </main>
  </div>

  <script>
    const PROFILES_KEY = "life_rpg_profiles";
    function tryReadJson(key){ const raw = localStorage.getItem(key); if(!raw) return null; try{ return JSON.parse(raw); }catch{ return null; } }
    const pack = tryReadJson(PROFILES_KEY);
    const prof = pack?.profiles?.[pack?.activeId];
    const s = prof?.state;
    const box = document.getElementById("blockedInfo");

    if(!s){
      box.innerHTML = "<b>데이터를 못 찾았어.</b><div style='opacity:.75;margin-top:6px;'>돌아가기를 누르면 게임으로 이동해.</div>";
    } else if(!s.block?.active){
      box.innerHTML = "<b>차단 상태가 아니야.</b><div style='opacity:.75;margin-top:6px;'>돌아가기를 누르면 게임으로 이동해.</div>";
    } else {
      const ended = new Date(s.block.endedAtMs || Date.now()).toLocaleString();
      box.innerHTML = "<b>프로필:</b> " + (prof.name||"-") +
        "<div style='opacity:.75;margin-top:6px;'><b>보상 종료:</b> " + (s.block.label||"-") + "</div>" +
        "<div style='opacity:.75;margin-top:6px;'>종료 시각: " + ended + "</div>";
    }

    document.getElementById("backBtn").onclick = () => {
      const p2 = tryReadJson(PROFILES_KEY);
      if(p2 && p2.profiles && p2.activeId && p2.profiles[p2.activeId]){
        const a = p2.profiles[p2.activeId];
        if(a?.state?.block) a.state.block.active = false;
        if(a?.state?.reward) a.state.reward.active = false;
        localStorage.setItem(PROFILES_KEY, JSON.stringify(p2));
      }
      location.href = "index.html";
    };
  </script>
</body>
</html>
